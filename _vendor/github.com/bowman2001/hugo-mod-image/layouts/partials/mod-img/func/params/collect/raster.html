{{/* Context: parameter map */}}

{{ $params := dict }}

{{ with .ratio }}{{ $params = merge $params (dict (slice "preprocess" "ratio") (float . ) ) }}{{ end }}
{{ with .zoom }}{{ $params = merge $params (dict (slice "preprocess" "zoom") (float . ) ) }}{{ end }}
{{ with .rotate }}{{ $params = merge $params (dict (slice "preprocess" "rotate") (. | lower) ) }}{{ end }}
{{ with .hint }}{{ $params = merge $params (dict (slice "preprocess" "hint") . ) }}{{ end }}
{{ with .anchor }}{{ $params = merge $params (dict (slice "preprocess" "anchor")  . ) }}{{ end }}

{{ with .lqip }}{{ $run := false }}{{ if (eq . "run") }}{{ $run = true }}{{ end }}
    {{ $params = merge $params (dict (slice "lqip" "run") $run) }}
{{ end }}

{{ return $params }}